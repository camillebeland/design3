\subsection{Asservissement de moteurs}

L'asservissement est une partie très importante du robot, permettant de s'assurer que les déplacement des roues correspondent aux commandes envoyées peu importe les perturbations externes. Pour être fiable, une boucle de rétroaction doit être calibrée avec les bonnes constantes et doit s'éxécutée rapidement.

Afin d'asservir les mouvements du robot, chaque moteur possède une boucle de rétroaction en vitesse de type PI éxécutée à une fréquence de 20Hz. Pour connaitre la position des roues, les encodeurs à effet Hall sont utilisés. Puisque la direction des roues sont connues, un seul channel par encodeur est utilisé. À chaque front montant de l'encodeur, une interruption survient dans le microcontroleur, qui ne fait que décrémenter le nombre de \textit{ticks} restant. Ainsi, lorsque la boucle de rétroaction est éxécutée, il est possible de compter la différence de position depuis la dernière itération, et donc d'en déduire la vitesse actuelle des roues. 

Suite à plusieurs essais et expérimentations, il fut convenut que les constantes optimales pour la régulation des roues en vitesses sont $KI = 0.03$ et $KP = 0.05$. 

Parallèlement, une seconde boucle de rétroaction est utilisée pour s'assurer que le robot se déplace en ligne droite. En effet, lors des mouvements en ligne droite, les roues opposées ont toujours la même instruction. La deuxième boucle de rétroaction agit donc sur la différence des positions des roues opposées. Cette différence doit être de 0, et l'asservissement sert à ralentir une roue si elle prend de l'avance sur la roue opposée. Les constantes utilisées sur ce second asservissement sont $KI = 0.0075$ et $KP = 0.015$.